import os
import sys
import xmlrpclib
from SimpleXMLRPCServer import SimpleXMLRPCServer

running = True

def start_consuming():
    os.system('su - opennebula -c "nohup python stream_analysis.py < /dev/null > std.out 2> std.err &"')
    return 'started'

def ping():
    return 'pong'


def stop_consuming():
    global running
    running = False
    return 'stopped'


server = SimpleXMLRPCServer(("<%=current_ip%>", 2187))
server.register_function(start_consuming, "start_consuming")
server.register_function(stop_consuming, "stop_consuming")
server.register_function(ping, "ping")
while running:
    server.handle_request()
