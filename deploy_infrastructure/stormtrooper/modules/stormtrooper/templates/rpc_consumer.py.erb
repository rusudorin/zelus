import os
import sys
import xmlrpclib
from SimpleXMLRPCServer import SimpleXMLRPCServer

def start_consuming():
    os.system('su - opennebula -c "nohup python stream_analysis.py < /dev/null > std.out 2> std.err &"')

    return True

def ping():
    return 'pong'


def stop_consuming():
    sys.exit()
    return True


server = SimpleXMLRPCServer(("<%=current_ip%>", 2187))
server.register_function(start_consuming, "start_consuming")
server.register_function(stop_consuming, "stop_consuming")
server.register_function(ping, "ping")
server.serve_forever()
